<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Data Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #charts { display: flex; flex-wrap: wrap; gap: 40px; }
        .chart-box { width: 600px; }
    </style>
</head>
<body>
    <h2>Data Visualization</h2>
    <a href="/admin/table">Back to Data Table</a> | 
    <a href="/admin/logout">Logout</a>
    <div id="charts">
      <div class="chart-box" style="overflow-x:auto; width:1000px;">
        <canvas id="barChart"></canvas>
      </div>
      <div class="chart-box">
        <canvas id="pieChart"></canvas>
      </div>
    </div>
    <script>
      // 1. 处理后端数据
      const raw = <%- JSON.stringify(chartData) %> ;
      // 拿到所有组合的“分类名”，和数量
      const labels = raw.map(r => `${r.theme} / ${r.subtheme} / ${r.category}`);
      const counts = raw.map(r => r.count);

      // 2. 条形图
      new Chart(document.getElementById('barChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Names Count per Category',
            data: counts,
            backgroundColor: 'rgba(54, 162, 235, 0.4)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: {
          plugins: {
            title: { display: true, text: 'Number of Names per Category' },
            legend: { display: false }
          },
        scales: {
            x: {
              ticks: {
                autoSkip: false,
                maxRotation: 60,   // 60度斜
                minRotation: 45    // 最小也转45度
              }
            },
            y: { beginAtZero: true, stepSize: 1 }
          }
        }
      });

      // 3. 饼图（只展示前10个最多的分类，演示用）
      const sorted = raw.slice().sort((a, b) => b.count - a.count).slice(0, 10);
      const pieLabels = sorted.map(r => `${r.theme}/${r.subtheme}/${r.category}`);
      const pieCounts = sorted.map(r => r.count);

      new Chart(document.getElementById('pieChart').getContext('2d'), {
        type: 'pie',
        data: {
          labels: pieLabels,
          datasets: [{
            label: 'Top 10 Categories',
            data: pieCounts
          }]
        },
        options: {
          plugins: {
            title: { display: true, text: 'Top 10 Categories by Name Count' }
          }
        }
      });
    </script>
</body>
</html>